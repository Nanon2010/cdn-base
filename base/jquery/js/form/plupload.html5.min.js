!function(F,m,x,p){var s,y={};function r(e,t){var n;if(!("FileReader"in F))return t(e.getAsBinary());(n=new FileReader).readAsBinaryString(e),n.onload=function(){t(n.result)}}function a(a,o,s,d){var l,u,f,g,c=this;!function(e,t){var n;if(!("FileReader"in F))return t(e.getAsDataURL());(n=new FileReader).readAsDataURL(e),n.onload=function(){t(n.result)}}(y[a.id],function(r){(l=m.createElement("canvas")).style.display="none",m.body.appendChild(l),u=l.getContext("2d"),(f=new Image).onerror=f.onabort=function(){d({success:!1})},f.onload=function(){var e,t,n,i;if(o.width||(o.width=f.width),o.height||(o.height=f.height),(g=Math.min(o.width/f.width,o.height/f.height))<1||1===g&&"image/jpeg"===s){if(e=Math.round(f.width*g),t=Math.round(f.height*g),l.width=e,l.height=t,u.drawImage(f,0,0,e,t),"image/jpeg"===s){if((n=new h(atob(r.substring(r.indexOf("base64,")+7)))).headers&&n.headers.length&&(i=new S).init(n.get("exif")[0])&&(i.setExif("PixelXDimension",e),i.setExif("PixelYDimension",t),n.set("exif",i.getBinary()),c.hasEventListener("ExifData")&&c.trigger("ExifData",a,i.EXIF()),c.hasEventListener("GpsData")&&c.trigger("GpsData",a,i.GPS())),o.quality)try{r=l.toDataURL(s,o.quality/100)}catch(e){r=l.toDataURL(s)}}else r=l.toDataURL(s);r=r.substring(r.indexOf("base64,")+7),r=atob(r),n&&n.headers&&n.headers.length&&(r=n.restore(r),n.purge()),l.parentNode.removeChild(l),d({success:!0,data:r})}else d({success:!1})},f.src=r})}function d(){var a,o=!1;function i(e,t){var n,i=o?0:-8*(t-1),r=0;for(n=0;n<t;n++)r|=a.charCodeAt(e+n)<<Math.abs(i+8*n);return r}function s(e,t,n){n=3===arguments.length?n:a.length-t-1;a=a.substr(0,t)+e+a.substr(n+t)}return{II:function(e){if(e===p)return o;o=e},init:function(e){o=!1,a=e},SEGMENT:function(e,t,n){switch(arguments.length){case 1:return a.substr(e,a.length-e-1);case 2:return a.substr(e,t);case 3:s(n,e,t);break;default:return a}},BYTE:function(e){return i(e,1)},SHORT:function(e){return i(e,2)},LONG:function(e,t){if(t===p)return i(e,4);!function(e,t,n){var i,r="",a=o?0:-8*(n-1);for(i=0;i<n;i++)r+=String.fromCharCode(t>>Math.abs(a+8*i)&255);s(r,e,n)}(e,t,4)},SLONG:function(e){var t=i(e,4);return 2147483647<t?t-4294967296:t},STRING:function(e,t){var n="";for(t+=e;e<t;e++)n+=String.fromCharCode(i(e,1));return n}}}function h(e){var a,o,t,n={65505:{app:"EXIF",name:"APP1",signature:"Exif\0"},65506:{app:"ICC",name:"APP2",signature:"ICC_PROFILE\0"},65517:{app:"IPTC",name:"APP13",signature:"Photoshop 3.0\0"}},s=[],i=p,r=0;if((a=new d).init(e),65496===a.SHORT(0)){for(o=2,t=Math.min(1048576,e.length);o<=t;)if(65488<=(i=a.SHORT(o))&&i<=65495)o+=2;else{if(65498===i||65497===i)break;r=a.SHORT(o+2)+2,n[i]&&a.STRING(o+4,n[i].signature.length)===n[i].signature&&s.push({hex:i,app:n[i].app.toUpperCase(),name:n[i].name.toUpperCase(),start:o,length:r,segment:a.SEGMENT(o,r)}),o+=r}return a.init(null),{headers:s,restore:function(e){a.init(e);var t=new h(e);if(!t.headers)return!1;for(var n=t.headers.length;0<n;n--){var i=t.headers[n-1];a.SEGMENT(i.start,i.length,"")}t.purge(),o=65504==a.SHORT(2)?4+a.SHORT(4):2;n=0;for(var r=s.length;n<r;n++)a.SEGMENT(o,0,s[n].segment),o+=s[n].length;return a.SEGMENT()},get:function(e){for(var t=[],n=0,i=s.length;n<i;n++)s[n].app===e.toUpperCase()&&t.push(s[n].segment);return t},set:function(e,t){var n=[];"string"==typeof t?n.push(t):n=t;for(var i=ii=0,r=s.length;i<r&&(s[i].app===e.toUpperCase()&&(s[i].segment=n[ii],s[i].length=n[ii].length,ii++),!(ii>=n.length));i++);},purge:function(){s=[],a.init(null)}}}}function S(){var g,l,c,h={};function r(e,t){var n,i,r,a,o,s,d,l=g.SHORT(e),u=[],f={};for(n=0;n<l;n++)if(s=e+12*n+2,(r=t[g.SHORT(s)])!==p){switch(a=g.SHORT(s+=2),o=g.LONG(s+=2),s+=4,u=[],a){case 1:case 7:for(4<o&&(s=g.LONG(s)+h.tiffHeader),i=0;i<o;i++)u[i]=g.BYTE(s+i);break;case 2:4<o&&(s=g.LONG(s)+h.tiffHeader),f[r]=g.STRING(s,o-1);continue;case 3:for(2<o&&(s=g.LONG(s)+h.tiffHeader),i=0;i<o;i++)u[i]=g.SHORT(s+2*i);break;case 4:for(1<o&&(s=g.LONG(s)+h.tiffHeader),i=0;i<o;i++)u[i]=g.LONG(s+4*i);break;case 5:for(s=g.LONG(s)+h.tiffHeader,i=0;i<o;i++)u[i]=g.LONG(s+4*i)/g.LONG(s+4*i+4);break;case 9:for(s=g.LONG(s)+h.tiffHeader,i=0;i<o;i++)u[i]=g.SLONG(s+4*i);break;case 10:for(s=g.LONG(s)+h.tiffHeader,i=0;i<o;i++)u[i]=g.SLONG(s+4*i)/g.SLONG(s+4*i+4);break;default:continue}d=1==o?u[0]:u,c.hasOwnProperty(r)&&"object"!=typeof d?f[r]=c[r][d]:f[r]=d}return f}return g=new d,l={tiff:{274:"Orientation",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}},c={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},{init:function(e){return h={tiffHeader:10},!(e===p||!e.length)&&(g.init(e),65505===g.SHORT(0)&&"EXIF\0"===g.STRING(4,5).toUpperCase()&&(n=h.tiffHeader,g.II(18761==g.SHORT(n)),42===g.SHORT(n+=2)&&(h.IFD0=h.tiffHeader+g.LONG(n+=2),t=r(h.IFD0,l.tiff),h.exifIFD="ExifIFDPointer"in t?h.tiffHeader+t.ExifIFDPointer:p,h.gpsIFD="GPSInfoIFDPointer"in t?h.tiffHeader+t.GPSInfoIFDPointer:p,!0)));var t,n},EXIF:function(){var e;if((e=r(h.exifIFD,l.exif)).ExifVersion&&"array"===x.typeOf(e.ExifVersion)){for(var t=0,n="";t<e.ExifVersion.length;t++)n+=String.fromCharCode(e.ExifVersion[t]);e.ExifVersion=n}return e},GPS:function(){var e;return(e=r(h.gpsIFD,l.gps)).GPSVersionID&&(e.GPSVersionID=e.GPSVersionID.join(".")),e},setExif:function(e,t){return("PixelXDimension"===e||"PixelYDimension"===e)&&function(e,t,n){var r,a,o,s=0;if("string"==typeof t){var d=l[e.toLowerCase()];for(hex in d)if(d[hex]===t){t=hex;break}}for(r=h[e.toLowerCase()+"IFD"],a=g.SHORT(r),i=0;i<a;i++)if(o=r+12*i+2,g.SHORT(o)==t){s=o+8;break}return!!s&&(g.LONG(s,n),!0)}("exif",e,t)},getBinary:function(){return g.SEGMENT()}}}x.runtimes.Html5=x.addRuntime("html5",{getFeatures:function(){var e,t,n,i,r,a,o;return t=n=r=a=!1,F.XMLHttpRequest&&(n=!!(e=new XMLHttpRequest).upload,t=!(!e.sendAsBinary&&!e.upload)),t&&(i=!!(e.sendAsBinary||F.Uint8Array&&F.ArrayBuffer),r=!(!File||!File.prototype.getAsDataURL&&!F.FileReader||!i),a=!(!File||!(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice))),s=x.ua.safari&&x.ua.windows,{html5:t,dragdrop:(o=m.createElement("div"),"draggable"in o||"ondragstart"in o&&"ondrop"in o),jpgresize:r,pngresize:r,multipart:r||!!F.FileReader||!!F.FormData,canSendBinary:i,cantSendBlobInFormData:!(!(x.ua.gecko&&F.FormData&&F.FileReader)||FileReader.prototype.readAsArrayBuffer),progress:n,chunks:a,multi_selection:!(x.ua.safari&&x.ua.windows),triggerDialog:x.ua.gecko&&F.FormData||x.ua.webkit}},init:function(h,e){var b,E;function p(e){var t,n,i,r=[],a={};for(n=0;n<e.length;n++)a[(t=e[n]).name]||(a[t.name]=!0,i=x.guid(),y[i]=t,r.push(new x.File(i,t.fileName||t.name,t.fileSize||t.size)));r.length&&h.trigger("FilesAdded",r)}(b=this.getFeatures()).html5?(h.bind("Init",function(n){var e,t,i,r,a,o,s,d=[],l=n.settings.filters,u=m.body;(e=m.createElement("div")).id=n.id+"_html5_container",x.extend(e.style,{position:"absolute",background:h.settings.shim_bgcolor||"transparent",width:"100px",height:"100px",overflow:"hidden",zIndex:99999,opacity:h.settings.shim_bgcolor?"":0}),e.className="plupload html5",h.settings.container&&(u=m.getElementById(h.settings.container),"static"===x.getStyle(u,"position")&&(u.style.position="relative")),u.appendChild(e);e:for(i=0;i<l.length;i++)for(a=l[i].extensions.split(/,/),r=0;r<a.length;r++){if("*"===a[r]){d=[];break e}(o=x.mimeTypes[a[r]])&&-1===x.inArray(o,d)&&d.push(o)}if(e.innerHTML='<input id="'+h.id+'_html5"  style="font-size:999px" type="file" accept="'+d.join(",")+'" '+(h.settings.multi_selection&&h.features.multi_selection?'multiple="multiple"':"")+" />",e.scrollTop=100,s=m.getElementById(h.id+"_html5"),n.features.triggerDialog?x.extend(s.style,{position:"absolute",width:"100%",height:"100%"}):x.extend(s.style,{cssFloat:"right",styleFloat:"right"}),s.onchange=function(){p(this.files),this.value=""},t=m.getElementById(n.settings.browse_button)){var f=n.settings.browse_button_hover,g=n.settings.browse_button_active,c=n.features.triggerDialog?t:e;f&&(x.addEvent(c,"mouseover",function(){x.addClass(t,f)},n.id),x.addEvent(c,"mouseout",function(){x.removeClass(t,f)},n.id)),g&&(x.addEvent(c,"mousedown",function(){x.addClass(t,g)},n.id),x.addEvent(m.body,"mouseup",function(){x.removeClass(t,g)},n.id)),n.features.triggerDialog&&x.addEvent(t,"click",function(e){var t=m.getElementById(n.id+"_html5");t&&!t.disabled&&t.click(),e.preventDefault()},n.id)}}),h.bind("PostInit",function(){var i=m.getElementById(h.settings.drop_element);if(i){if(s)return void x.addEvent(i,"dragenter",function(e){var t,n;(t=m.getElementById(h.id+"_drop"))||((t=m.createElement("input")).setAttribute("type","file"),t.setAttribute("id",h.id+"_drop"),t.setAttribute("multiple","multiple"),x.addEvent(t,"change",function(){p(this.files),x.removeEvent(t,"change",h.id),t.parentNode.removeChild(t)},h.id),i.appendChild(t)),x.getPos(i,m.getElementById(h.settings.container)),n=x.getSize(i),"static"===x.getStyle(i,"position")&&x.extend(i.style,{position:"relative"}),x.extend(t.style,{position:"absolute",display:"block",top:0,left:0,width:n.w+"px",height:n.h+"px",opacity:0})},h.id);x.addEvent(i,"dragover",function(e){e.preventDefault()},h.id),x.addEvent(i,"drop",function(e){var t=e.dataTransfer;t&&t.files&&p(t.files),e.preventDefault()},h.id)}}),h.bind("Refresh",function(e){var t,n,i,r,a;(t=m.getElementById(h.settings.browse_button))&&(n=x.getPos(t,m.getElementById(e.settings.container)),i=x.getSize(t),r=m.getElementById(h.id+"_html5_container"),x.extend(r.style,{top:n.y+"px",left:n.x+"px",width:i.w+"px",height:i.h+"px"}),h.features.triggerDialog&&("static"===x.getStyle(t,"position")&&x.extend(t.style,{position:"relative"}),a=parseInt(x.getStyle(t,"z-index"),10),isNaN(a)&&(a=0),x.extend(t.style,{zIndex:a}),x.extend(r.style,{zIndex:a-1})))}),h.bind("DisableBrowse",function(e,t){var n=m.getElementById(e.id+"_html5");n&&(n.disabled=t)}),h.bind("CancelUpload",function(){E&&E.abort&&E.abort()}),h.bind("UploadFile",function(S,v){var t,i=S.settings;function n(t){var m=0,y=0,n="FileReader"in F?new FileReader:null;!function d(){var l,u,f,g,c,h,p=S.settings.url;function e(n){var i,t=0,r="----pluploadboundary"+x.guid(),a="\r\n",o="";if((E=new XMLHttpRequest).upload&&(E.upload.onprogress=function(e){v.loaded=Math.min(v.size,y+e.loaded-t),S.trigger("UploadProgress",v)}),E.onreadystatechange=function(){var t,e;if(4==E.readyState&&S.state!==x.STOPPED){try{t=E.status}catch(e){t=0}if(400<=t)S.trigger("Error",{code:x.HTTP_ERROR,message:x.translate("HTTP Error."),file:v,status:t});else{if(u){if(e={chunk:m,chunks:u,response:E.responseText,status:t},S.trigger("ChunkUploaded",v,e),y+=c,e.cancelled)return void(v.status=x.FAILED);v.loaded=Math.min(v.size,(m+1)*g)}else v.loaded=v.size;S.trigger("UploadProgress",v),n=l=i=o=null,!u||++m>=u?(v.status=x.DONE,S.trigger("FileUploaded",v,{response:E.responseText,status:t})):d()}}},S.settings.multipart&&b.multipart){if(f.name=v.target_name||v.name,E.open("post",p,!0),x.each(S.settings.headers,function(e,t){E.setRequestHeader(t,e)}),"string"!=typeof n&&F.FormData)return i=new FormData,x.each(x.extend(f,S.settings.multipart_params),function(e,t){i.append(t,e)}),i.append(S.settings.file_data_name,n),void E.send(i);if("string"==typeof n){if(E.setRequestHeader("Content-Type","multipart/form-data; boundary="+r),x.each(x.extend(f,S.settings.multipart_params),function(e,t){o+="--"+r+a+'Content-Disposition: form-data; name="'+t+'"'+a+a,o+=unescape(encodeURIComponent(e))+a}),h=x.mimeTypes[v.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream",o+="--"+r+a+'Content-Disposition: form-data; name="'+S.settings.file_data_name+'"; filename="'+unescape(encodeURIComponent(v.name))+'"'+a+"Content-Type: "+h+a+a+n+a+"--"+r+"--"+a,t=o.length-n.length,n=o,E.sendAsBinary)E.sendAsBinary(n);else if(b.canSendBinary){for(var e=new Uint8Array(n.length),s=0;s<n.length;s++)e[s]=255&n.charCodeAt(s);E.send(e.buffer)}return}}p=x.buildUrl(S.settings.url,x.extend(f,S.settings.multipart_params)),E.open("post",p,!0),E.setRequestHeader("Content-Type","application/octet-stream"),x.each(S.settings.headers,function(e,t){E.setRequestHeader(t,e)}),E.send(n)}v.status!=x.DONE&&v.status!=x.FAILED&&S.state!=x.STOPPED&&(f={name:v.target_name||v.name},i.chunk_size&&v.size>i.chunk_size&&(b.chunks||"string"==typeof t)?(g=i.chunk_size,u=Math.ceil(v.size/g),c=Math.min(g,v.size-m*g),l="string"==typeof t?t.substring(m*g,m*g+c):function(t,n,i){var e;if(!File.prototype.slice)return(e=File.prototype.webkitSlice||File.prototype.mozSlice)?e.call(t,n,i):null;try{return t.slice(),t.slice(n,i)}catch(e){return t.slice(n,i-n)}}(t,m*g,m*g+c),f.chunk=m,f.chunks=u):(c=v.size,l=t),S.settings.multipart&&b.multipart&&"string"!=typeof l&&n&&b.cantSendBlobInFormData&&b.chunks&&S.settings.chunk_size?(n.onload=function(){e(n.result)},n.readAsBinaryString(l)):e(l))}()}t=y[v.id],b.jpgresize&&S.settings.resize&&/\.(png|jpg|jpeg)$/i.test(v.name)?a.call(S,v,S.settings.resize,/\.png$/i.test(v.name)?"image/png":"image/jpeg",function(e){e.success?(v.size=e.data.length,n(e.data)):b.chunks?n(t):r(t,n)}):!b.chunks&&b.jpgresize?r(t,n):n(t)}),h.bind("Destroy",function(e){var t,n,i=m.body,r={inputContainer:e.id+"_html5_container",inputFile:e.id+"_html5",browseButton:e.settings.browse_button,dropElm:e.settings.drop_element};for(t in r)(n=m.getElementById(r[t]))&&x.removeAllEvents(n,e.id);x.removeAllEvents(m.body,e.id),e.settings.container&&(i=m.getElementById(e.settings.container)),i.removeChild(m.getElementById(r.inputContainer))}),e({success:!0})):e({success:!1})}})}(window,document,plupload);